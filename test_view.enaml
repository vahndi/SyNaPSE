#Atom
from atom.api import Atom, Value, ContainerList, Str

# Enaml
import enaml
from enaml.core.api import Include
from enaml.qt.qt_application import QtApplication

from enaml.widgets.api import (
    DockPane, GroupBox, Window, RadioButton, Label, ObjectCombo, Form, 
    PushButton
                               )                              
from custom_views.RadioButtonList import RadioButtonList_View
from custom_views.CheckBoxList import CheckBoxList_View



class element(object):
    
    
    def __init__(self, name = '', parent = None):

        self.name = name
        self.parent = parent


    def __str__(self):
        print 'getting element name for %s' % self.name
        return self.name


    def select(self):        

        print '%s was selected' % self.name


    def toggle(self, value):
        
        print '%s was toggled to %s' % (self.name, value)
        if self.parent is not None:
            self.parent.toggle_item(self, value)

    

class MainModel(object):


    class ui(Atom):

        elements = ContainerList(element)
        selectedElement = Value(element)
        checked_indices = ContainerList(int)


    def __init__(self):
        
        self.elements = [element('a', parent = self), 
                         element('b', parent = self), 
                         element('c', parent = self)]

        self.uiModel = MainModel.ui(elements = self.elements,
                                    selectedElement = self.elements[0],
                                    checked_indices = [1])


    def add_element(self):
        
        self.elements.append(element('d', parent = self))
        self.uiModel.elements = self.elements
        
    
    def check_all(self):
        print 'checking all'
        self.uiModel.checked_indices = list(range(len(self.elements)))
        
    def uncheck_all(self):
        
        self.uiModel.checked_indices = []
        
    def toggle_item(self, item, value):
        
        item_index = self.elements.index(item)
        checked_indices = [i for i in self.uiModel.checked_indices]
        if value:
            print 'appending item %i' % item_index
            checked_indices.append(item_index)
        else:
            print 'removing item %i' % item_index            
            checked_indices.remove(item_index)
        self.uiModel.checked_indices = checked_indices



enamldef Main(Window): main:
    
    attr model
    
    GroupBox:
        Form:
            Label:
                text = 'elements'
            ObjectCombo:
                items := model.uiModel.elements
                selected := model.uiModel.selectedElement
                to_string = str
            Label:
                text = 'selected element'
            Label:
                text := model.uiModel.selectedElement.name
            PushButton:
                text = 'Add New Element'
                clicked::
                    model.add_element()
                    print [str(e) for e in model.uiModel.elements]


        RadioButtonList_View:
            
            model := main.model.uiModel.elements

        
        CheckBoxList_View:
            
            check_items := main.model.uiModel.elements
            checked_indices := main.model.uiModel.checked_indices
            scroll_area = True
            fn_check_all = main.model.check_all
            fn_uncheck_all = main.model.uncheck_all
        


if __name__ == '__main__':

    app = QtApplication()
    view = Main(model = MainModel())

    view.show()
    app.start()